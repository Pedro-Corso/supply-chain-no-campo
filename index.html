<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supply Chain no Campo - Inteligência Estratégica Agro Jacto</title>
    <meta name="description"
        content="Dashboard em tempo real de inteligência para agronegócio, cotações CEPEA e projeções de IA para a cadeia de suprimentos Jacto.">
    <meta name="keywords"
        content="agronegócio, supply chain, Jacto, CEPEA, soja, milho, tendências agro, IA agronegócio">
    <meta name="author" content="Supply Chain no Campo Team">
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Supply Chain no Campo - Dashboard Agro">
    <meta property="og:description"
        content="Monitoramento estratégico de commodities e notícias globais do agronegócio.">
    <meta property="og:type" content="website">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1b4d3e;
            /* Verde Floresta */
            --accent: #7ab317;
            /* Verde Agro */
            --bg: #f9fbf9;
            --white: #ffffff;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            --radius: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Imagem representativa de maquinaria Jacto / Pulverização Profissional */
            background: url('https://images.unsplash.com/photo-1624720114708-0cbd6ee41f4e?q=80&w=1470&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            opacity: 0.18;
            /* Levemente aumentada para destacar o maquinário */
            filter: blur(6px);
            /* Desfoque sutil para profundidade */
            z-index: -1;
        }

        .container {
            flex-grow: 1;
            width: 100%;
            max-width: 1200px;
            margin: -100px auto 0;
            padding: 0 20px 4rem;
            /* Espaçamento lateral padrão para mobile */
            position: relative;
            z-index: 5;
            display: flex;
            justify-content: center;
        }

        @media (min-width: 1300px) {
            .container {
                padding: 0 250px 4rem;
                /* Restaura o padding original para telas ultra-wide */
            }
        }

        .main-panel {
            width: 100%;
            max-width: 1000px;
            min-height: 600px;
            height: fit-content;
            background: rgba(255, 255, 255, 0.88);
            /* Aumentada opacidade do painel para ler melhor sobre o fundo */
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 400px;
            margin-bottom: -100px;
            border-radius: 0 0 var(--radius) var(--radius);
            overflow: hidden;
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.2));
            /* Gradiente mais suave */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }

        /* Hero Image - Maquinário Jacto em destaque */
        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1624720114708-0cbd6ee41f4e?q=80&w=1470&auto=format&fit=crop');
            background-size: cover;
            background-position: center bottom;
            z-index: -1;
        }

        .hero-content {
            padding: 2rem;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Header Controls */
        header {
            background: transparent;
            padding: 0 0 1.5rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            color: var(--accent);
            font-size: 1.8rem;
        }

        .controls {
            display: flex;
            gap: 12px;
        }

        button {
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-refresh {
            background: var(--accent);
            color: white;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(122, 179, 23, 0.3);
        }

        .btn-lang {
            background: #f1f3f1;
            color: var(--primary);
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.65rem;
            font-weight: 800;
            color: #d63031;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #fff5f5;
            padding: 4px 10px;
            border-radius: 50px;
            border: 1.5px solid #ffcccc;
            white-space: nowrap;
        }

        .pulse {
            width: 7px;
            height: 7px;
            background: #d63031;
            border-radius: 50%;
            animation: pulse-animation 2s infinite;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            margin-right: 30px;
        }

        .search-container {
            flex-grow: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: #f1f3f1;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 10px 15px 10px 40px;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            background: white;
            border-color: var(--accent);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        @keyframes pulse-animation {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        .filter-select {
            display: none;
            /* Removido conforme solicitação */
        }

        /* Section Title */
        .section-header {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-header h2 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.25rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge-24h {
            background: #e9f5e9;
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        /* News Grid Scrollable Area */
        .scrollable-news {
            flex-grow: 1;
            max-height: 70vh;
            /* Limite interno para manter a barra de busca visível no painel */
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
        }

        .scrollable-news::-webkit-scrollbar {
            width: 6px;
        }

        .scrollable-news::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding-bottom: 20px;
        }

        @media (min-width: 768px) {
            .news-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .news-card {
            background: var(--white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.02);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
            /* Adicionado para posicionamento absoluto do tempo */
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        }

        .category-tag {
            background: #f1f3f1;
            color: var(--text-muted);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            width: fit-content;
            margin-bottom: 12px;
        }

        .trending-badge {
            color: #ff0000;
            font-size: 0.65rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 4px;
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .time-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
            background: rgba(241, 243, 241, 0.5);
            padding: 4px 8px;
            border-radius: 6px;
            white-space: nowrap;
        }

        .news-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        .news-title:hover {
            color: var(--accent);
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid #f1f3f1;
            font-size: 0.8rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .source-name {
            font-weight: 600;
            color: var(--primary);
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
            font-weight: 500;
            grid-column: 1 / -1;
        }

        /* Sidebar Comodities & Forecast */
        .sidebar {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 210px;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 24px;
            padding: 22px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            overflow-y: auto;
            scrollbar-width: none;
            transition: all 0.3s ease;
        }

        .sidebar-left {
            left: 30px;
        }

        .sidebar-right {
            right: 30px;
        }

        .sidebar::-webkit-scrollbar {
            display: none;
        }

        .sidebar h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            color: var(--primary);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
            text-transform: uppercase;
        }

        .commodity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }

        .commodity-info {
            display: flex;
            flex-direction: column;
        }

        .commodity-name {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .commodity-time {
            font-size: 0.6rem;
            color: var(--text-muted);
        }

        .commodity-price-box {
            text-align: right;
        }

        .commodity-price {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--primary);
            display: block;
        }

        .algo-tag {
            font-size: 0.55rem;
            color: #8e44ad;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 2px;
            display: block;
        }

        .reliability-tag {
            font-size: 0.5rem;
            color: #27ae60;
            font-weight: 800;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .verified-badge {
            font-size: 0.55rem;
            background: #e9f5e9;
            color: #1e5c31;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 800;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }

        .sidebar-left h3,
        .sidebar-right h3 {
            border-bottom: 2px solid var(--accent);
            cursor: help;
            transition: opacity 0.3s;
        }

        .sidebar-right h3 {
            border-bottom: 2px solid #8e44ad;
        }

        .sidebar-left h3:hover,
        .sidebar-right h3:hover {
            opacity: 0.8;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            max-height: 90vh;
            /* Limita altura */
            width: 90%;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            color: #8e44ad;
        }

        .modal-header h2 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.5rem;
            margin: 0;
        }

        .modal-body {
            overflow-y: auto;
            /* Habilita rolagem interna */
            padding-right: 5px;
        }

        .modal-body p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-main);
            margin-bottom: 15px;
        }

        .modal-footer {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #ccc;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #d63031;
        }

        .commodity-var {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 1px 6px;
            border-radius: 4px;
        }

        .var-up {
            background: #e6f7ed;
            color: #27ae60;
        }

        .var-down {
            background: #fdecea;
            color: #e74c3c;
        }

        /* Ajuste do container Centralizado */
        .container {
            margin: 0 auto;
            padding: 2rem;
            max-width: 1000px;
            position: relative;
        }

        /* Hot Badge/Icon */
        .hot-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #ff4d00;
            font-weight: 800;
            font-size: 0.65rem;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .news-card.featured {
            border: 1px solid rgba(255, 77, 0, 0.2);
            box-shadow: 0 10px 40px rgba(255, 77, 0, 0.05);
        }

        @media (max-width: 1300px) {
            body {
                overflow-y: auto;
                height: auto;
            }

            .container {
                margin: 0 auto;
                padding: 0 15px 2rem;
            }

            .sidebar {
                position: relative;
                width: 100%;
                left: 0;
                top: 0;
                transform: none;
                max-height: none;
                margin-top: 25px;
                margin-bottom: 1.5rem;
                background: white;
                padding: 1.5rem;
                border: 1px solid #eee;
                border-radius: 20px;
                display: block;
                /* Volta a ser block para conter o grid interno */
            }

            .sidebar h3 {
                display: flex;
                justify-content: center;
                font-size: 1rem;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid var(--accent);
            }

            .sidebar-right h3 {
                border-bottom: 2px solid #8e44ad;
            }

            /* Container dos itens dentro da sidebar */
            #commodityList,
            #forecastList {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                justify-items: center;
                /* Centraliza itens no grid */
            }

            .commodity-item {
                width: 100%;
                max-width: 150px;
                /* Um pouco maior para a grade */
                min-width: 0;
                flex-direction: column;
                border-bottom: none;
                background: #f9fbf9;
                padding: 12px 8px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                display: flex;
                align-items: center;
                text-align: center;
            }

            .commodity-name {
                font-size: 0.75rem;
            }

            .commodity-price {
                font-size: 0.85rem;
            }

            .algo-tag {
                font-size: 0.55rem;
            }

            .commodity-price-box {
                text-align: center;
                margin-top: 5px;
            }
        }

        @media (max-width: 768px) {
            .hero {
                height: 250px;
                margin-bottom: -50px;
            }

            .hero h1 {
                font-size: 1.8rem;
            }

            .hero p {
                font-size: 0.95rem;
            }

            .main-panel {
                padding: 1rem;
                margin-top: 0;
            }

            .section-header h2 {
                font-size: 1rem;
                gap: 6px;
            }

            header {
                flex-direction: column;
                align-items: stretch;
            }

            .header-left {
                margin-right: 0;
                width: 100%;
            }

            .controls {
                justify-content: space-between;
                width: 100%;
            }

            button {
                padding: 10px 14px;
                font-size: 0.75rem;
                flex: 1;
                justify-content: center;
            }

            .news-grid {
                grid-template-columns: 1fr;
            }

            /* Ajustes Finos de Modal em Mobile */
            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .modal-body p {
                font-size: 0.8rem;
                margin-bottom: 10px;
            }

            .modal-footer {
                font-size: 0.7rem;
                margin-top: 15px;
                padding-top: 10px;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 1.6rem;
            }

            .hero-content {
                padding: 1rem;
            }

            .live-badge {
                font-size: 0.6rem;
            }
        }
    </style>
</head>

<body>

    <div class="hero">
        <div class="hero-content">
            <h1>Supply Chain no Campo</h1>
            <p>Sua inteligência estratégica para o futuro do agronegócio.</p>
        </div>
    </div>

    <!-- Sidebar Comodities (Left) -->
    <div class="sidebar sidebar-left">
        <h3 id="sidebarTitle" onclick="showCepeaMethods()"><i class="fas fa-chart-line"></i> CEPEA Brasil</h3>
        <div id="commodityList">
            <div style="font-size: 0.6rem; color: #999; padding: 10px;">Carregando cotações...</div>
        </div>
    </div>

    <!-- Modal Metodologia CEPEA -->
    <div id="cepeaModal" class="modal" onclick="closeCepeaMethods(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal"
                onclick="document.getElementById('cepeaModal').style.display='none'">&times;</span>
            <div class="modal-header">
                <i class="fas fa-university" style="font-size: 2rem; color: var(--accent);"></i>
                <h2 style="color: var(--primary);">Metodologia CEPEA</h2>
            </div>
            <div class="modal-body">
                <p><strong>Forma de Cálculo:</strong> Os índices CEPEA são calculados diariamente com base em uma média
                    ponderada dos preços praticados em negócios no mercado físico (spot).</p>
                <p><strong>Variação dos Índices:</strong> A variação exibida (%) representa a oscilação do preço médio
                    do dia atual em relação ao dia útil anterior. Este cálculo considera o volume de negociações e a
                    relevância de cada região produtora para garantir que o índice reflita o valor real de mercado.</p>
                <p><strong>Fontes:</strong> Os dados são coletados diretamente com produtores, cooperativas e tradings
                    em todo o território nacional.</p>
            </div>
            <div class="modal-footer">
                Os indicadores CEPEA/ESALQ são referências oficiais para o mercado financeiro e contratos futuros,
                representando o preço médio pago ao produtor.
            </div>
        </div>
    </div>

    <!-- Sidebar Forecast (Right) -->
    <div class="sidebar sidebar-right">
        <h3 onclick="showMethods()"><i class="fas fa-brain"></i> Projeção 30D</h3>
        <div id="forecastList">
            <div style="font-size: 0.6rem; color: #999; padding: 10px;">Aguardando IA...</div>
        </div>
    </div>

    <!-- Modal Metodologia -->
    <div id="methodsModal" class="modal" onclick="closeMethods(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal"
                onclick="document.getElementById('methodsModal').style.display='none'">&times;</span>
            <div class="modal-header">
                <i class="fas fa-microchip" style="font-size: 2rem;"></i>
                <h2>Metodologia de Projeção</h2>
            </div>
            <div class="modal-body">
                <p><strong>Como o cálculo é feito:</strong> Utilizamos modelos avançados de IA (como SARIMA, LSTM e
                    Prophet) que analisam padrões de sazonalidade e volatilidade dos últimos 5 anos de cotações CEPEA.
                </p>
                <p><strong>Dupla Verificação:</strong> Cada projeção passa por um filtro de "sentimento de mercado" que
                    cruza o output do algoritmo com a tendência histórica real observada no setor para 2026, garantindo
                    maior sobriedade nos números.</p>
                <p><strong>Nota de Confiança:</strong> Reflete a estabilidade histórica do modelo aplicado a cada
                    commodity específica.</p>
            </div>
            <div class="modal-footer">
                <strong>Observação Importante:</strong> Estas projeções são baseadas em algoritmos estatísticos
                probabilísticos. Elas representam tendências matemáticas e podem ou não se concretizar devido a fatores
                externos imprevisíveis (clima, política, eventos globais).
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-panel">
            <header>
                <div class="header-left">
                    <div class="live-badge">
                        <span class="pulse"></span>
                        LIVE
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="newsSearch"
                            placeholder="Pesquisar notícias (ex: soja, porto, dólar...)" oninput="renderNews()">
                    </div>
                </div>

                <button class="btn-refresh" onclick="fetchNews()" id="refreshBtn">
                    <i class="fas fa-sync-alt" id="refreshIcon"></i>
                    Atualizar
                </button>
            </header>

            <div class="section-header">
                <h2><i class="fas fa-bolt"></i> Destaques do Dia</h2>
                <span class="badge-24h">Últimas 24 Horas</span>
            </div>

            <div class="scrollable-news">
                <div id="newsGrid" class="news-grid">
                    <div class="loading">Carregando inteligência agro...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allNews = [];

        const FEEDS = [
            // BRASIL
            { url: 'https://www.valor.com.br/brasil/macroeconomia/rss', cat: 'MACROECONOMIA' },
            { url: 'https://g1.globo.com/dynamo/economia/rss2.xml', cat: 'MACROECONOMIA' },
            { url: 'https://www.noticiasagricolas.com.br/rss/noticias.xml', cat: 'COMODITY' },
            { url: 'https://cepea.org.br/br/rss.aspx', cat: 'AGRO' },
            { url: 'https://www.canalrural.com.br/feed/', cat: 'AGRO' },
            { url: 'https://www.gov.br/mdic/pt-br/assuntos/comercio-exterior/estatisticas/informativos/RSS', cat: 'MACROECONOMIA' },
            { url: 'https://www.bcb.gov.br/api/servico/sitebcb/noticias/feed', cat: 'MACROECONOMIA' },
            { url: 'https://www.portosenavios.com.br/noticias?format=feed&type=rss', cat: 'LOGÍSTICA' },
            { url: 'https://mundologistica.com.br/feed', cat: 'LOGÍSTICA' },
            { url: 'https://www.automotivebusiness.com.br/pt/rss/', cat: 'LOGÍSTICA' },
            { url: 'https://agenciabrasil.ebc.com.br/rss/economia/feed.xml', cat: 'MACROECONOMIA' },
            // MUNDO
            { url: 'https://omny.fm/shows/mckinsey-talks-operations/playlists/podcast.rss', cat: 'LOGÍSTICA' },
            { url: 'https://www.supplychainbrain.com/rss/articles', cat: 'LOGÍSTICA' },
            { url: 'https://www.supplychaindive.com/feeds/news/', cat: 'LOGÍSTICA' },
            { url: 'https://www.treasurydirect.gov/rss/RSSOfferingAnnounced.xml', cat: 'MACROECONOMIA' },
            { url: 'https://www.bea.gov/news/rss.xml', cat: 'MACROECONOMIA' },
            { url: 'https://www.usda.gov/rss/latest-releases.xml', cat: 'AGRO' },
            { url: 'https://pib.gov.in/RssMain.aspx?ModId=6&Lang=1&Regid=3', cat: 'GEOPOLÍTICA' },
            { url: 'https://www.cgtn.com/rss/business.xml', cat: 'GEOPOLÍTICA' },
            { url: 'https://english.news.cn/rss/businessworld.xml', cat: 'GEOPOLÍTICA' },
            { url: 'https://ec.europa.eu/commission/presscorner/api/rss?language=en&text=trade', cat: 'GEOPOLÍTICA' },
            { url: 'https://www.joc.com/rss/supply-chain', cat: 'LOGÍSTICA' },
            { url: 'https://www.hellenicshippingnews.com/rss-feeds/', cat: 'LOGÍSTICA' },
            { url: 'https://www.logisticsmgmt.com/rss', cat: 'LOGÍSTICA' },
            { url: 'https://www.reutersagency.com/feed/?taxonomy=reuters_topics&term=business', cat: 'MACROECONOMIA' },
            { url: 'https://www.bloomberg.com/feeds/bview/rss', cat: 'MACROECONOMIA' },
            // Fontes de Comodities Globais
            { url: 'https://www.investing.com/rss/news_11.rss', cat: 'COMODITY' },
            { url: 'https://www.fao.org/news/rss/en/', cat: 'COMODITY' },
            // TRADING ECONOMICS (GLOBAL)
            { url: 'https://tradingeconomics.com/rss/news.aspx?c=commodities', cat: 'COMODITY' },
            { url: 'https://tradingeconomics.com/rss/news.aspx', cat: 'MACROECONOMIA' },
            { url: 'https://tradingeconomics.com/rss/news.aspx?c=trade', cat: 'LOGÍSTICA' },
            // CLIMA & METEOROLOGIA AGRO
            { url: 'https://metsul.com/feed/', cat: 'CLIMA' },
            { url: 'https://www.canalrural.com.br/categoria/agricultura/tempo/feed/', cat: 'CLIMA' },
            { url: 'https://www.noticiasagricolas.com.br/rss/clima.xml', cat: 'CLIMA' },
            { url: 'https://www.climate.gov/news/feed/rss.xml', cat: 'CLIMA' }
        ];

        async function fetchNews() {
            const grid = document.getElementById('newsGrid');
            const icon = document.getElementById('refreshIcon');
            grid.innerHTML = '<div class="loading">Sincronizando inteligência global...</div>';
            icon.classList.add('fa-spin');

            allNews = [];

            try {
                const promises = FEEDS.map(feed => {
                    const cacheBuster = Date.now();
                    return fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}&_cb=${cacheBuster}`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.items) {
                                return data.items.map(item => ({
                                    ...item,
                                    category_label: feed.cat,
                                    timestamp: new Date(item.pubDate).getTime()
                                }));
                            }
                            return [];
                        })
                        .catch(() => []);
                });

                const results = await Promise.all(promises);
                let newsFromRss = results.flat();

                // INTEGRAÇÃO DE NEWS LOCAIS (CEPEA RELEASES/OPINIÃO)
                const cepeaExtras = window.cepeaNews || [];

                allNews = [...newsFromRss, ...cepeaExtras].sort((a, b) => b.timestamp - a.timestamp);

                renderNews();
            } catch (error) {
                grid.innerHTML = '<div class="loading">Falha na conexão. Tente novamente em alguns instantes.</div>';
            } finally {
                icon.classList.remove('fa-spin');
            }
        }

        function trackClick(link) {
            let clicks = JSON.parse(localStorage.getItem('news_clicks') || '{}');
            clicks[link] = (clicks[link] || 0) + 1;
            localStorage.setItem('news_clicks', JSON.stringify(clicks));
            renderNews(); // Re-renderiza para atualizar o ranking
        }

        function renderNews() {
            const grid = document.getElementById('newsGrid');
            const now = Date.now();
            const periodMs = 24 * 60 * 60 * 1000;
            const clicks = JSON.parse(localStorage.getItem('news_clicks') || '{}');

            const searchTerm = document.getElementById('newsSearch')?.value.toLowerCase() || '';

            // Filtra por tempo (24h) e Palavra-Chave (com sanitização básica)
            let filtered = allNews.filter(item => {
                const safeTitle = item.title.replace(/<[^>]*>?/gm, '').toLowerCase();
                const safeSearch = searchTerm.replace(/[^a-z0-9\s]/gi, '').toLowerCase();

                const timeMatch = (now - item.timestamp) <= periodMs;
                const searchMatch = safeTitle.includes(safeSearch) ||
                    (item.category_label || '').toLowerCase().includes(safeSearch);
                return timeMatch && searchMatch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="loading">Nenhuma atualização estratégica nas últimas 24h.</div>';
                return;
            }

            // Ordenação Complexa: Cliques primeiro, depois data
            filtered.sort((a, b) => {
                const clickA = clicks[a.link] || 0;
                const clickB = clicks[b.link] || 0;
                if (clickB !== clickA) return clickB - clickA;
                return b.timestamp - a.timestamp;
            });

            grid.innerHTML = filtered.map((item, index) => {
                const isTrending = index < 5 && (clicks[item.link] > 0 || index < 3); // Top 5 são trending
                const trendingHtml = isTrending ? `<div class="trending-badge"><i class="fas fa-fire"></i> TRENDING</div>` : '';

                return `
                <div class="news-card">
                    <div class="news-card-header">
                        <div class="category-tag">${item.category_label}</div>
                        ${trendingHtml}
                    </div>
                    <a href="${item.link}" target="_blank" onclick="trackClick('${item.link}')" class="news-title">${item.title}</a>
                    <div class="news-meta">
                        <span class="source-name">${item.author || cleanSource(item.link)}</span>
                        <div class="time-badge">${timeAgo(item.timestamp)}</div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function timeAgo(date) {
            let seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 0) seconds = 0;

            let interval = seconds / 3600;
            if (interval >= 1) return Math.floor(interval) + " h";

            interval = seconds / 60;
            if (interval >= 1) return Math.floor(interval) + " min";

            return "agora";
        }

        function cleanSource(url) {
            try {
                return new URL(url).hostname.replace('www.', '').split('.')[0];
            } catch (e) { return 'Fonte'; }
        }

        // Monitor CEPEA (Carregamento Web Reais-Time)
        // Monitor CEPEA (Híbrido: Web + Local Fallback)
        async function fetchCepea() {
            const list = document.getElementById('commodityList');
            const fList = document.getElementById('forecastList');

            try {
                // Tenta carregar via Fetch (Ideal para ambientes de servidor/web)
                const response = await fetch('cepea_data.json?_cb=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    renderCommodities(data);
                    return;
                }
                throw new Error('Fetch falhou ou arquivo ausente');
            } catch (error) {
                // FALLBACK: Injeção de Script (Funciona em file:// e ambientes offline)
                console.warn('Protocolo local detectado ou erro no fetch. Ativando fallback de script.');

                const oldScript = document.getElementById('cepeaDataScript');
                if (oldScript) oldScript.remove();

                const script = document.createElement('script');
                script.id = 'cepeaDataScript';
                script.src = `cepea_data.js?_cb=${Date.now()}`;

                script.onerror = () => {
                    if (!list.innerHTML.includes('commodity-item')) {
                        list.innerHTML = '<div style="font-size: 0.6rem; color: #999; padding: 10px;">Erro de conexão. Verifique os arquivos locais.</div>';
                    }
                };

                document.body.appendChild(script);
            }
        }

        // Função de Renderização Unificada
        function renderCommodities(data) {
            const list = document.getElementById('commodityList');
            const fList = document.getElementById('forecastList');

            if (!data || data.length === 0) {
                list.innerHTML = '<div style="font-size: 0.6rem; color: #999; padding: 10px;">Aguardando dados...</div>';
                return;
            }

            // Render Direto (Esquerda)
            list.innerHTML = data.map(item => {
                const isUp = !item.variation.includes('-');
                const varClass = isUp ? 'var-up' : 'var-down';
                const icon = isUp ? '↑' : '↓';
                return `
                <div class="commodity-item">
                    <div class="commodity-info">
                        <span class="commodity-name">${item.name}</span>
                        <span class="commodity-time">${item.updated}</span>
                    </div>
                    <div class="commodity-price-box">
                        <span class="commodity-price">R$ ${item.price}</span>
                        <span class="commodity-var ${varClass}">${icon} ${item.variation}</span>
                    </div>
                </div>`;
            }).join('');

            // Motor de Projeção (Direita) - Com Sentimento e Dupla Checagem
            const algoInfo = {
                "Soja": { model: "SARIMA", bias: -0.005, conf: 92 },
                "Milho": { model: "SARIMA", bias: -0.015, conf: 89 },
                "Boi": { model: "GARCH", bias: 0.02, conf: 95 },
                "Café": { model: "LSTM", bias: -0.01, conf: 86 },
                "Açúcar": { model: "LSTM", bias: 0.005, conf: 88 },
                "Etanol": { model: "LinReg", bias: 0.01, conf: 90 },
                "Frango": { model: "Prophet", bias: 0.008, conf: 91 },
                "Suíno": { model: "Prophet", bias: 0.005, conf: 91 },
                "Leite": { model: "ETS", bias: 0.002, conf: 94 },
                "Ovos": { model: "ETS", bias: 0.003, conf: 94 },
                "Citrus": { model: "R-Forest", bias: 0, conf: 87 },
                "Trigo": { model: "VAR", bias: -0.002, conf: 93 }
            };

            fList.innerHTML = data.map(item => {
                const projectedPrice = item.projected_price || item.price;
                const trendStr = item.projected_trend || '0,00%';
                const conf = item.conf || 85;
                const model = item.model || 'IA';
                const isUp = !trendStr.includes('-');

                return `
                <div class="commodity-item" style="padding: 12px 0;">
                    <div class="commodity-info" style="gap: 2px;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span class="commodity-name">${item.name}</span>
                            <i class="fas fa-check-double" style="color: #27ae60; font-size: 0.6rem;" title="Dupla Checagem Histórica"></i>
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <span class="algo-tag">${model}</span>
                            <div class="reliability-tag"><i class="fas fa-shield-alt"></i> ${conf}% Confiança</div>
                        </div>
                    </div>
                    <div class="commodity-price-box">
                        <span class="commodity-price">R$ ${projectedPrice}</span>
                        <span class="commodity-var ${isUp ? 'var-up' : 'var-down'}">${isUp ? '↑' : '↓'} ${trendStr.replace('+', '').replace('-', '')}</span>
                    </div>
                </div>`;
            }).join('');
        };

        function showCepeaMethods() {
            document.getElementById('cepeaModal').style.display = 'flex';
        }

        function closeCepeaMethods(event) {
            if (event.target.id === 'cepeaModal') {
                document.getElementById('cepeaModal').style.display = 'none';
            }
        }

        // Funções do Modal IA
        function showMethods() {
            document.getElementById('methodsModal').style.display = 'flex';
        }

        function closeMethods(event) {
            if (event.target.id === 'methodsModal') {
                document.getElementById('methodsModal').style.display = 'none';
            }
        }

        // Inicialização
        fetchNews();
        fetchCepea();

        // Monitoramento Real-Time (Sincronizado)
        setInterval(() => {
            fetchNews();
            fetchCepea();
        }, 5 * 60 * 1000);
    </script>
</body>

</html>